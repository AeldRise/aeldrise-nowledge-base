
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ "–°–ø–∏—Å–æ–∫ —Ç–µ–º –Ω–æ–≤–æ—Å—Ç–µ–π"
## –§–∞–π–ª—ã
```
/local/components/my/news.themes/
‚îú‚îÄ‚îÄ .description.php
‚îú‚îÄ‚îÄ .parameters.php
‚îú‚îÄ‚îÄ component.php
‚îî‚îÄ‚îÄ templates/.default/
    ‚îú‚îÄ‚îÄ template.php
    ‚îî‚îÄ‚îÄ style.css
```

### ‚öôÔ∏è 1. `.parameters.php` ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```php
<?php
if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die();

if (!CModule::IncludeModule('iblock')) {
    return;
}

$arComponentParameters = array(
    'GROUPS' => array(
        'SETTINGS' => array(
            'NAME' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
        ),
    ),
    'PARAMETERS' => array(
        'THEMES_IBLOCK_ID' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => 'ID –∏–Ω—Ñ–æ–±–ª–æ–∫–∞ "–¢–µ–º—ã"',
            'TYPE'    => 'STRING',
            'DEFAULT' => '',
        ),
        'NEWS_IBLOCK_ID' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => 'ID –∏–Ω—Ñ–æ–±–ª–æ–∫–∞ "–ù–æ–≤–æ—Å—Ç–∏"',
            'TYPE'    => 'STRING',
            'DEFAULT' => '',
        ),
        'THEME_PROPERTY_CODE' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => '–ö–æ–¥ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ –Ω–æ–≤–æ—Å—Ç—è—Ö',
            'TYPE'    => 'STRING',
            'DEFAULT' => 'THEME',
        ),
        'SHOW_COUNT' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => '–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π',
            'TYPE'    => 'CHECKBOX',
            'DEFAULT' => 'Y',
        ),
        'SORT_BY' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',
            'TYPE'    => 'LIST',
            'VALUES'  => array(
                'NAME' => '–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é',
                'SORT' => '–ü–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ',
            ),
            'DEFAULT' => 'NAME',
        ),
        'SORT_ORDER' => array(
            'PARENT'  => 'SETTINGS',
            'NAME'    => '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',
            'TYPE'    => 'LIST',
            'VALUES'  => array(
                'ASC'  => '–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é',
                'DESC' => '–ü–æ —É–±—ã–≤–∞–Ω–∏—é',
            ),
            'DEFAULT' => 'ASC',
        ),
        'CACHE_TIME' => array(
            'DEFAULT' => 3600
        ),
    ),
);
```

---

### üß† 2. `component.php` ‚Äî –ª–æ–≥–∏–∫–∞ —Å —É—Å–ª–æ–≤–∏–µ–º

```php
<?php
if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die();

if (!CModule::IncludeModule('iblock')) {
    ShowError('–ú–æ–¥—É–ª—å "–ò–Ω—Ñ–æ–±–ª–æ–∫–∏" –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω.');
    return;
}

// –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
$themesIblockId = (int)$this->arParams['THEMES_IBLOCK_ID'];
$newsIblockId   = (int)$this->arParams['NEWS_IBLOCK_ID'];
$themePropCode  = $this->arParams['THEME_PROPERTY_CODE'] ?: 'THEME';
$showCount      = $this->arParams['SHOW_COUNT'] === 'Y';
$sortBy         = $this->arParams['SORT_BY'] === 'SORT' ? 'SORT' : 'NAME';
$sortOrder      = $this->arParams['SORT_ORDER'] === 'DESC' ? 'DESC' : 'ASC';

if ($themesIblockId <= 0) {
    ShowError('–ù–µ —É–∫–∞–∑–∞–Ω ID –∏–Ω—Ñ–æ–±–ª–æ–∫–∞ "–¢–µ–º—ã".');
    return;
}

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
if ($this->StartResultCache()) {

    // –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ–º—ã
    $dbThemes = CIBlockElement::GetList(
        array($sortBy => $sortOrder),
        array(
            'IBLOCK_ID' => $themesIblockId,
            'ACTIVE'    => 'Y'
        ),
        false,
        false,
        array('ID', 'NAME', 'CODE', 'DETAIL_PAGE_URL')
    );

    $arResult['THEMES'] = array();

    while ($arTheme = $dbThemes->GetNext()) {
        $arResult['THEMES'][] = array(
            'ID'    => $arTheme['ID'],
            'NAME'  => htmlspecialcharsbx($arTheme['NAME']),
            'URL'   => $arTheme['DETAIL_PAGE_URL'] ?: '/themes/' . $arTheme['CODE'] . '/',
            'COUNT' => 0, // –≤—Ä–µ–º–µ–Ω–Ω–æ
        );
    }

    // –®–∞–≥ 2: –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî —Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π
    if ($showCount && $newsIblockId > 0 && !empty($arResult['THEMES'])) {
        $themeIds = array_column($arResult['THEMES'], 'ID');

        $dbNews = CIBlockElement::GetList(
            array(),
            array(
                'IBLOCK_ID' => $newsIblockId,
                'ACTIVE'    => 'Y',
                'PROPERTY_' . $themePropCode => $themeIds,
            ),
            array('PROPERTY_' . $themePropCode),
            false,
            array('PROPERTY_' . $themePropCode)
        );

        $countMap = array();
        while ($arNews = $dbNews->GetNext()) {
            $themeId = $arNews['PROPERTY_' . $themePropCode . '_VALUE'];
            $countMap[$themeId] = (int)$arNews['CNT'];
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫–∏
        foreach ($arResult['THEMES'] as &$theme) {
            $theme['COUNT'] = $countMap[$theme['ID']] ?? 0;
        }
        unset($theme);
    }

    // –ï—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫ –Ω–µ –Ω—É–∂–µ–Ω ‚Äî —É–¥–∞–ª—è–µ–º –ø–æ–ª–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å
    if (!$showCount) {
        foreach ($arResult['THEMES'] as &$theme) {
            unset($theme['COUNT']);
        }
        unset($theme);
    }

    $this->IncludeComponentTemplate();
}
```

> üîπ `SHOW_COUNT === 'Y'` ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ —Å—á–∏—Ç–∞–µ–º  
> üîπ `array('CNT')` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ  
> üîπ `array_column()` ‚Äî –ø–æ–ª—É—á–∞–µ–º ID —Ç–µ–º –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞  
> üîπ –ï—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫ –æ—Ç–∫–ª—é—á—ë–Ω ‚Äî –ø–æ–ª–µ `COUNT` –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω

---

### üé® 3. `templates/.default/template.php` ‚Äî —à–∞–±–ª–æ–Ω —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π

```php
<?php if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die(); ?>

<?php
$this->addExternalCss($this->GetFolder() . '/style.css');
?>

<div class="my-news-themes">
    <h3>–¢–µ–º—ã –Ω–æ–≤–æ—Å—Ç–µ–π</h3>
    <?php if (!empty($arResult['THEMES'])): ?>
        <ul class="themes-list">
            <?php foreach ($arResult['THEMES'] as $theme): ?>
                <li class="theme-item">
                    <a href="<?= $theme['URL'] ?>" class="theme-link">
                        <?= $theme['NAME'] ?>
                    </a>
                    <?php if (isset($theme['COUNT'])): ?>
                        <span class="theme-count">
                            (<?= $theme['COUNT'] ?>)
                        </span>
                    <?php endif; ?>
                </li>
            <?php endforeach; ?>
        </ul>
    <?php else: ?>
        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º.</p>
    <?php endif; ?>
</div>
```

> üîπ `isset($theme['COUNT'])` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å —Å—á—ë—Ç—á–∏–∫

---

## ‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

```php
<?php
// –° –ø–æ–¥—Å—á—ë—Ç–æ–º
$APPLICATION->IncludeComponent(
    "my:news.themes",
    ".default",
    array(
        "THEMES_IBLOCK_ID"     => 4,
        "NEWS_IBLOCK_ID"       => 3,
        "THEME_PROPERTY_CODE"  => "THEME",
        "SHOW_COUNT"           => "Y", // –≤–∫–ª—é—á–µ–Ω–æ
        "SORT_BY"              => "NAME",
        "SORT_ORDER"           => "ASC",
        "CACHE_TIME"           => 3600
    )
);
?>

<?php
// –ë–µ–∑ –ø–æ–¥—Å—á—ë—Ç–∞ (–±—ã—Å—Ç—Ä–µ–µ!)
$APPLICATION->IncludeComponent(
    "my:news.themes",
    ".default",
    array(
        "THEMES_IBLOCK_ID"     => 4,
        "THEME_PROPERTY_CODE"  => "THEME",
        "SHOW_COUNT"           => "N", // –≤—ã–∫–ª—é—á–µ–Ω–æ
        "SORT_BY"              => "SORT",
        "SORT_ORDER"           => "ASC",
        "CACHE_TIME"           => 3600
    )
);
?>
```

---

## –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ —Ç–µ–º—ã —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏ (`COUNT > 0`)
- –ü–æ–¥–¥–µ—Ä–∂–∫—É URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `?theme=sport`)
- –ü–æ–¥—Å–≤–µ—Ç–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
